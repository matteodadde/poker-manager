[flake8]
# Lunghezza massima della riga (Black usa 88 di default, 90 è una buona alternativa)
max-line-length = 90
# Ignora regole specifiche per compatibilità con Black
extend-ignore = 
    E203, W503
exclude = 
    .git,
    __pycache__,
    venv/,
    .venv/,
    env/,
    instance/,
    migrations/,
    app/static/,
    app/templates/,
    app/tests/,
    node_modules/,
    .mypy_cache/,
    .pytest_cache/,
    .coverage
# Seleziona i plugin da eseguire (la tua configurazione originale)
select = C,E,F,W,B,B950

# --- NUOVO: Configurazione di Pytest ---
[tool:pytest]
# Cerca i test solo nella cartella 'app/tests'
testpaths = app/tests

env =
    FLASK_ENV = testing
# Aggiunge opzioni standard per test più chiari
addopts = 
    -ra 
    -v 
    --cov=app --cov-branch
    --cov-report=term-missing
    --cov-report=html

# --- NUOVO: Configurazione di Coverage (pytest-cov) ---
[coverage:run]
# Non calcolare la copertura per questi file
omit =
    app/tests/*
    app/config/*
    app_factory.py
    run.py
    logging_config.py
    app/routes/errors/*
    app/utils/filters.py
    app/__init__.py
    */__init__.py
    */migrations/*
    app/templates/*
    app/scripts/*
    seed_data.py
    wsgi.py

[coverage:report]
# Fallisce il test se la copertura totale è inferiore all'80%
fail_under = 80
# Mostra i numeri di riga mancanti nel report del terminale
show_missing = True

# --- NUOVO: Configurazione di Black (Formattatore) ---
[tool:black]
# Imposta la lunghezza della riga (deve corrispondere a flake8)
line-length = 90
# Esclude le stesse cartelle di flake8
exclude = 
    /(
        \.git
        | \.venv
        | venv
        | __pycache__
        | instance
        | migrations
        | node_modules
        | \.mypy_cache
        | \.pytest_cache
        | \.coverage
    )/

# --- NUOVO: Configurazione di Mypy (Type Checking) ---
[mypy]
# Cerca i tipi in tutte le cartelle dell'app
files = app/
# Ignora i pacchetti installati di cui non trova i tipi
ignore_missing_imports = True
# Abilita controlli più severi
disallow_untyped_defs = True
warn_redundant_casts = True
warn_unused_ignores = True
# Esclude le cartelle che non necessitano di controllo dei tipi
exclude = 
    venv/
    | \.venv/
    | instance/
    | migrations/
    | app/tests/